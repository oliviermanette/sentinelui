var WeatherForecastDisplay=function(){function t(t){this.rawSelector=t.selector,!t.location&&localStorage&&(t.location=localStorage.getItem("loc")),t.location||(t.location="_auto_"),this.config={location:t.location,unitGroup:t.unitGroup||"us",key:t.apiKey,hourly:!1,showInstallLink:t.showInstallLink},this.dailydata=null,this.hourlydata=null,this.error=null;var a=this;this.setLocation=function(t){t||(t="_auto_"),a.config.location=t,a.dailydata=null,a.hourlydata=null,a.loadForecastData()},this.loadForecastData=function(){if(!a.error&&!(a.config.hourly&&a.hourlydata||!a.config.hourly&&a.dailydata)){var e=t.root||"https://weather.visualcrossing.com/VisualCrossingWebServices/rest/services/weatherdata/";e+="forecast?",e+="unitGroup="+a.config.unitGroup+"&contentType=json&shortColumnNames=true&location="+a.config.location+"&key="+a.config.key,e+="&aggregateHours="+(a.config.hourly?"1":"24"),d3.json(e,(function(t,e){t?(console.error("Error loading weather forecast data: "+t),a.error="Error loading data"):e?e.errorCode?(console.error("Error loading weather forecast data: "+e.message),a.error="Error loading data"):(a.processValues(e),a.config.hourly?a.hourlydata=e:a.dailydata=e):(console.error("Error loading weather forecast data (no data)"),a.error="Error loading data"),a.refresh()}))}},this.processValues=function(t){var e=a.getForecastValues(t);if(e){var r=6e4*(new Date).getTimezoneOffset();e.forEach((function(t){t.datetime=new Date(t.datetime+r)}))}},this.getForecastValues=function(t){if(!t)throw"No data available for "+a.config.location;var e=t.locations;if(!e)throw"No locations found in data for "+a.config.location;var r=e[Object.keys(e)[0]];r&&r.address&&(localStorage&&localStorage.setItem("loc",r.address),a.config.location=r.address);var o=r.values;return o=o.filter((function(t){return t&&(t.temp||0===t.temp)}))},this.refresh=function(){a.loadForecastData();var t=d3.select(a.rawSelector);if(a.error)t.html("<div class='error'>"+a.error+"</div>");else{var r=a.getForecastValues(a.config.hourly?a.hourlydata:a.dailydata),o=d3.timeFormat("%b %d"),i=d3.timeFormat("%H"),n=d3.format(".0f"),s=function(t){return"us"===a.config.unitGroup?5*(t+459.67)/9:t+273.15};if(t.classed("forecastwidget",!0),t.select(".location").empty())if(t.html("<div class='location'><span class='value'>-</span><input type='text' class='editor' value=''></input><div class='viewchooser day' title='View by day'>Daily</div><div class='viewchooser hour' title='View by hour'>Hourly</div></div><div class='days noselect'></div><svg class='chart'></svg><div class='footer'>"+(a.config.showInstallLink?"<a href='https://www.visualcrossing.com/weather-widgets' title='Install this weather widget' target='_blank'>Install</a>":"")+"<a href='https://www.visualcrossing.com/weather-api' title='Powered by the Visual Crossing Weather API' target='_blank'>Credit</a></div>"),window.ResizeObserver)new ResizeObserver((function(){a.refresh()})).observe(t.node());t.selectAll(".viewchooser").classed("selected",(function(){return d3.select(this).classed("day")&&!a.config.hourly||d3.select(this).classed("hour")&&a.config.hourly})).on("click",(function(t){d3.select(this).classed("day")?a.config.hourly=!1:a.config.hourly=!0,a.refresh()}));var c=t.select(".location");c.select(".value").html(a.config.location);var l=c.select(".editor");l.attr("value",a.config.location),l.on("keypress",(function(){13===d3.event.keyCode&&(c.classed("edit",!1),a.setLocation(l.node().value))})),c.select(".value").on("click",(function(){d3.event.target!==l.node()&&(c.classed("edit",!c.classed("edit")),d3.event.stopPropagation())})),d3.select("body").on("click",(function(){l.filter((function(t){return this==d3.event.target})).empty()&&c.classed("edit",!1)}));var d=t.node().getBoundingClientRect(),u={top:0,right:20,bottom:0,left:20},f=d.width-u.left-u.right,h=a.config.hourly?60:70,p=d3.extent(r,(function(t){return t.datetime})),m=a.config.hourly?d3.timeHour.count(p[0],p[1]):d3.timeDay.count(p[0],p[1]),g=f/m;g<h&&(g=h);var v=d3.scaleTime().range([0,m*g]);v.domain(p);var y=t.select(".days").style("width",f+"px").style("left",u.left+"px").selectAll(".day").data(r);y.exit().remove();var w=y.enter().append("div").attr("class","day").html("<div class='date'></div><div class='icon'></div><div class='maxt'></div><div class='mint'></div><div class='temp'></div><div class='precip'><span class='value'></span></div><div class='conditions'></div>");(y=y.merge(w)).style("top","5px").transition().style("left",(function(t){return v(t.datetime)+"px"})).style("width",g+"px"),y.select(".icon").each((function(t){var e=d3.select(this),a={sunny:!1,partsunny:!1,cloudy:!1,wind:!1,rain:!1,snow:!1};t&&(+t.precip>.1||+t.pop>40?a.rain=!0:+t.wspd>40?a.wind=!0:+t.cloudcover>75?a.cloudy=!0:+t.cloudcover>30?a.partsunny=!0:a.sunny=!0),Object.keys(a).forEach((function(t){e.classed(t,a[t])}))})),y.select(".precip").each((function(t){d3.select(this).classed("hidden",!t.precip),d3.select(this).select(".value").html(t.precip)})),y.select(".conditions").html((function(t){return t.conditions})),y.select(".date").html((function(t){return a.config.hourly&&+d3.timeDay.floor(t.datetime)!=+t.datetime?i(t.datetime):o(t.datetime)})),y.select(".maxt").classed("hidden",a.config.hourly).html((function(t){return n(t.maxt)})),y.select(".mint").classed("hidden",a.config.hourly).html((function(t){return n(t.mint)})),y.select(".temp").classed("hidden",!a.config.hourly).html((function(t){return n(t.temp)}));var x,b=d3.select(a.rawSelector).select(".chart"),k=(d=b.node().getBoundingClientRect()).height-u.top-u.bottom;if(b.select("g").empty()){var M=b;M.append("clipPath").attr("id","clippath").append("rect").attr("x",0).attr("y",0).attr("width",0).attr("height",0),M=M.append("g").attr("transform","translate("+u.left+","+u.top+")").attr("clip-path","url(#clippath)"),(x=M.append("g").attr("class","container")).append("path").attr("class","line"),x.append("g").attr("class","bars"),x.append("linearGradient").attr("id","temperature-gradient").attr("gradientUnits","userSpaceOnUse"),x.append("g").attr("class","grid")}else x=b.select(".container");b.select("#clippath rect").attr("x",-u.left).attr("width",d.width).attr("height",d.height),x.attr("transform",null);var C=d3.scaleLinear().range([k,0]),E=d3.scaleLinear().range([k,.67*k]),F=d3.area().x((function(t,e){return 0===e?v(t.datetime):e===r.length-1?v(a.config.hourly?d3.timeHour.offset(t.datetime,1):d3.timeHour.offset(t.datetime,24)):v(a.config.hourly?d3.timeHour.offset(t.datetime,.5):d3.timeHour.offset(t.datetime,12))})).y0(k).y1((function(t){return C(a.config.hourly?t.temp:t.maxt)})).curve(d3.curveCatmullRom);C.domain([d3.min(r,(function(t){return(a.config.hourly?t.temp:t.mint)-10})),d3.max(r,(function(t){return a.config.hourly?t.temp:t.maxt}))]),E.domain([0,d3.max(r,(function(t){return t.precip}))]).nice();for(var D=s(C.domain()[0]),H=(s(C.domain()[1])-D)/11,S=[],V=0;V<=10;V++){var I=(D+H*V-255)/56;I=Math.max(I,0),I=Math.min(I,1),S.push({offset:10*V+"%",color:e(I)})}var L=x.select("#temperature-gradient").attr("x1",0).attr("y1",C(C.domain()[0])).attr("x2",0).attr("y2",C(C.domain()[1])).selectAll("stop").data(S,(function(t){return t.color}));L.exit().remove(),(L=L.merge(L.enter().append("stop"))).attr("offset",(function(t){return t.offset})).attr("stop-color",(function(t){return t.color})).attr("stop-opacity",(function(t,e){return.5+.5*e/S.length}));var z=x.select(".bars").selectAll(".precipbar").data(r);z.exit().remove();var G=z.enter().append("rect").attr("class","precipbar").attr("x",0).attr("y",0).attr("height",0);(z=z.merge(G)).transition().attr("x",(function(t,e){return v(a.config.hourly?d3.timeHour.offset(t.datetime,.5):d3.timeHour.offset(t.datetime,12))-5})).attr("width",(function(t,e){return 10})).attr("y",(function(t,e){return E(t.precip)})).attr("height",(function(t,e){return E(0)-E(t.precip)})),x.select(".line").data([r]).transition().attr("d",F),x.select(".grid").attr("transform","translate(0,"+k+")").call(d3.axisBottom(v).ticks(m).tickSize(-k).tickFormat(""));var O=d3.zoom().scaleExtent([1,1]).translateExtent([[0,0],[(m+2)*g,0]]).on("zoom",(function(){var e=d3.event.transform;e.k=1,e.y=0,t.select(".days").style("left",u.left+e.x+"px"),x.attr("transform",e)}));t.call(O)}}}function e(t){return t=Math.max(0,Math.min(1,t)),"rgb("+Math.max(0,Math.min(255,Math.round(34.61+t*(1172.33-t*(10793.56-t*(33300.12-t*(38394.49-14825.05*t)))))))+", "+Math.max(0,Math.min(255,Math.round(23.31+t*(557.33+t*(1225.33-t*(3574.96-t*(1073.77+707.56*t)))))))+", "+Math.max(0,Math.min(255,Math.round(27.2+t*(3211.1-t*(15327.97-t*(27814-t*(22569.18-6838.66*t)))))))+")"}return(window.weatherWidgetConfig?window.weatherWidgetConfig.forEach((function(e){!function(e){var a=new t(e);a.loadForecastData()}(e)})):console.error("No weather widget configuration found!"),{})}();