function resetZoom(e){e.resetZoom()}function drawNoDataAvailable(e){Chart.plugins.register({afterDraw:function(e){if(0===e.data.datasets.length){var a=e.chart.ctx,t=e.chart.width,o=e.chart.height;e.clear(),a.save(),a.textAlign="center",a.textBaseline="middle",a.font="35px normal 'Helvetica Nueue'",a.fillStyle="gray",a.fillText("Pas encore de ce type de données disponible pour ce capteur",t/2,o/2),a.restore()}}});var a=$("#"+e);new Chart(a,{type:"line",data:{labels:[],datasets:[]}})}function drawVerticalAxis(e){Chart.plugins.register({beforeDraw:function(e,a){if(e.config.data.drawXYAxes){var t=e.chart.ctx,o=e.scales.scale;t.save(),t.beginPath(),t.strokeStyle="#0000ff",t.lineWidth=.75,drawArrow(t,o.xCenter,o.yCenter,o.xCenter-o.drawingArea-100,o.yCenter),drawArrow(t,o.xCenter,o.yCenter,o.xCenter+o.drawingArea+100,o.yCenter),drawArrow(t,o.xCenter,o.yCenter,o.xCenter,o.yCenter-o.drawingArea-40),drawArrow(t,o.xCenter,o.yCenter,o.xCenter,o.yCenter+o.drawingArea+40),t.stroke(),t.restore()}}})}function drawChartNbChocPerDate(e,a="canvas_choc_nb"){if("object"!=typeof e&&(e=JSON.parse(e)),isEmpty(e))drawNoDataAvailable(a);else{var t=[],o=[];for(var r in e)t.push(e[r].nb_choc),o.push(e[r].date_d);var i={labels:o,datasets:[{labels:o,data:t}]},l=$("#"+a),n={maintainAspectRatio:!1,responsive:!0,plugins:[ChartDataLabels],scales:{xAxes:[{scaleLabel:{display:!0,labelString:"Date"},gridLines:{display:!1}}],yAxes:[{ticks:{beginAtZero:!0,stepSize:1},gridLines:{display:!1},scaleLabel:{display:!0,labelString:"Nombre Choc"}}]},legend:{display:!1},title:{display:!0,text:"Nombre de choc enregistré",fontSize:15},pan:{enabled:!1,mode:"xy"},zoom:{enabled:!1,mode:"xy"}};new Chart(l,{type:"bar",data:i,options:n})}}function drawChartPowerChocPerDate(e,a="canvas_choc_nb"){if("object"!=typeof e&&(e=JSON.parse(e)),isEmpty(e))drawNoDataAvailable(a);else{var t=[],o=[],r=Array(),i=[];for(var l in e){var n=new Date(e[l].date_d),s={x:n=getFormattedDate(n),y:e[l].power};i.push(s),count=l,o.includes(e[l].date_d)||(1,0,r.length>0&&t.push(r),r=Array(),o.push(e[l].date_d)),o.includes(e[l].date_d)&&(r.push(e[l].power),1)}t.push(r);var d=$("#"+a);new Chart(d,{type:"scatter",data:{datasets:[{label:"Puissance du choc (g)",data:i,fill:!1,showLine:!1,backgroundColor:"#F5DEB3",borderColor:"red"}]},options:{maintainAspectRatio:!0,responsive:!0,title:{display:!0,text:"Chart.js Time Scale"},scales:{xAxes:[{stacked:!0,type:"time",ticks:{source:"date"},time:{format:"DD/MM/YYYY",unit:"day",tooltipFormat:"DD/MM/YYYY",scaleLabel:{display:!0,labelString:"Date"}}}],yAxes:[{stacked:!1,scaleLabel:{display:!0,labelString:"Puissance"}}]},pan:{enabled:!1,mode:"xy"},zoom:{enabled:!1,mode:"xy"}}})}}function drawChartPowerChocPerDateBar(e,a="canvas_choc_nb"){if("object"!=typeof e&&(e=JSON.parse(e)),isEmpty(e))drawNoDataAvailable(a);else{var t=[],o=[],r=$("#"+a),i=new Chart(r,{type:"bar",data:{labels:[],datasets:[{data:[]}]},options:{maintainAspectRatio:!1,responsive:!0,tooltips:{callbacks:{title:function(e,a){return"Le "+a.labels[e[0].index]+" à "+n.get(e[0].value).split(" ")[1]},label:function(e,a){return"Puissance : "+e.value+" g"},afterLabel:function(e,a){}},backgroundColor:"#FFF",titleFontSize:15,titleFontColor:"#233754",bodyFontColor:"#000",bodyFontSize:14,displayColors:!1},scales:{xAxes:[{stacked:!0,scaleLabel:{display:!0,labelString:"Date"},gridLines:{display:!1}}],yAxes:[{stacked:!0,ticks:{beginAtZero:!0,stepSize:.1},gridLines:{display:!1},scaleLabel:{display:!0,labelString:"Puissance du choc (g)"}}]},legend:{display:!1},title:{display:!0,text:"Puissance des chocs enregistrés",fontSize:15},pan:{enabled:!1,mode:"xy"},zoom:{enabled:!1,mode:"xy"}}}),l=Array(),n=new Map;for(var s in e){let a=e[s].date_d,r=a.split(" ")[0],i=(a.split(" ")[1],e[s].power);n.set(i,a),o.includes(r)||(0,l.length>0&&t.push(l),l=Array(),o.push(r)),o.includes(r)&&(l.push(i),1)}t.push(l);var d=[];for(var p in o)d.push({date:o[p],powerValues:t[p]});var c=Array("#919191","#4b809c","#106d9c","#a37524","#a34f3e");for(let e=0;e<12;e++){i.data.datasets.push({data:[]})}for(const[e,a]of Object.entries(d)){i.data.labels[e]=a.date,i.update();var b=a.powerValues.map((function(e){return parseFloat(e)})),u=Math.max.apply(null,b);Math.min.apply(null,b);for(let a=0;a<12;a++)a>=0&&a<b.length?(b[a]==u?i.data.datasets[a].backgroundColor="#d93c1c":i.data.datasets[a].backgroundColor=c[a],i.data.datasets[a].data[e]=b[a]):i.data.datasets[a].data[e]=0;i.update()}}}function drawChartTemperatureFromData(e,a){if("object"!=typeof e&&(e=JSON.parse(e)),isEmpty(e))drawNoDataAvailable(a);else{var t=[],o=[];for(var r in e)e[r].temperature<100&&(t.push(e[r].temperature),o.push(e[r].date_d));var i={labels:o,datasets:[{labels:o,lineTension:.1,backgroundColor:"rgba(167,105,0,0.4)",borderColor:"rgb(167, 105, 0)",borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",pointBorderColor:"white",pointBorderWidth:1,pointHoverRadius:8,pointHoverBorderColor:"yellow",pointHoverBorderWidth:2,pointRadius:4,pointHitRadius:10,spanGaps:!0,data:t}]},l=$("#"+a);new Chart(l,{type:"line",data:i,options:{responsive:!0,maintainAspectRatio:!1,scales:{xAxes:[{scaleLabel:{display:!0,labelString:"Date"},ticks:{autoskip:!0,maxTicksLimit:15}}],yAxes:[{ticks:{beginAtZero:!1},scaleLabel:{display:!0,labelString:"Temeprature (°C)"}}]},legend:{display:!1},title:{display:!0,text:"Temperature relevé par le capteur en fonction du temps",fontSize:18},pan:{enabled:!1,mode:"xy"},zoom:{enabled:!1,mode:"xy"}}})}}function drawChartHistoricalTemperature(e,a){if("object"!=typeof e&&(e=JSON.parse(e)),isEmpty(e))drawNoDataAvailable(a);else{var t=[],o=[];for(var r in e)e[r].temperature<100&&(t.push(e[r].temperature),o.push(e[r].date_d));var i={labels:o,datasets:[{labels:o,backgroundColor:"rgba(79,117,180,0.4)",borderColor:"rgba(49,85,144,1)",borderWidth:1,lineTension:0,data:t}]},l=$("#"+a);new Chart(l,{type:"line",data:i,options:{responsive:!0,maintainAspectRatio:!1,scales:{xAxes:[{scaleLabel:{display:!0,labelString:"Date"},ticks:{autoskip:!0,maxTicksLimit:20}}],yAxes:[{ticks:{beginAtZero:!1},scaleLabel:{display:!0,labelString:"Temeprature (°C)"}}]},legend:{display:!1},title:{display:!0,text:"Température de référence (méteo locale) en fonction du temps",fontSize:18},pan:{enabled:!1,mode:"xy"},zoom:{enabled:!1,mode:"xy"}}})}}function drawBothTemperature(e,a,t){if("object"!=typeof e&&(e=JSON.parse(e)),"object"!=typeof a&&(a=JSON.parse(a)),isEmpty(e))drawNoDataAvailable(t);else{let i=[],l=[],n=[],s=[];for(let a in e)e[a].temperature<100&&(i.push(e[a].temperature),n.push(e[a].date_d));for(let e in a)a[e].temperature<100&&(l.push(a[e].temperature),s.push(a[e].date_d),l.push(null),s.push(a[e].date_d));console.log("date :",n),console.log("Sensor temperature :",e),console.log("weather temperature :",a),console.log("Official temperature :",l),console.log("Sensor temperature :",i);var o={labels:n,datasets:[{fill:!0,label:"Température de la station météo",lineTension:.1,backgroundColor:"rgba(167,105,0,0.4)",borderColor:"rgb(167, 105, 0)",borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",pointBorderColor:"white",pointBackgroundColor:"black",pointBorderWidth:1,pointHoverRadius:8,pointHoverBackgroundColor:"brown",pointHoverBorderColor:"yellow",pointHoverBorderWidth:2,pointRadius:4,pointHitRadius:10,spanGaps:!0,xAxisID:"xAxis1",data:l},{fill:!1,label:"Température du capteur",borderColor:"red",borderWidth:1,lineTension:0,borderCapStyle:"square",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",pointBorderColor:"black",pointBackgroundColor:"white",pointBorderWidth:1,pointHoverRadius:8,pointHoverBackgroundColor:"yellow",pointHoverBorderColor:"brown",pointHoverBorderWidth:2,pointRadius:4,pointHitRadius:10,spanGaps:!1,xAxisID:"xAxis2",data:i}]},r=$("#"+t);new Chart(r,{type:"line",data:o,options:{responsive:!0,maintainAspectRatio:!1,scales:{xAxes:[{id:"xAxis1",scaleLabel:{display:!0,labelString:"Date"},ticks:{autoskip:!0,maxTicksLimit:20}},{id:"xAxis2",autoskip:!0,maxTicksLimit:20}],yAxes:[{ticks:{beginAtZero:!1},scaleLabel:{display:!0,labelString:"Temperature (°C)"}}]},legend:{display:!0},title:{display:!0,text:"Temperature de référence",fontSize:18},pan:{enabled:!1,mode:"xy"},zoom:{enabled:!1,mode:"xy"}}})}}function drawChartInclinometerFromData(e,a="canvas_inclinometre"){"object"!=typeof e&&(e=JSON.parse(e));var t=[],o=[],r=[],i=[];for(var l in e)t.push(e[l].nx),o.push(e[l].ny),r.push(e[l].nz),i.push(e[l].date_d);var n={labels:i,datasets:[{label:"X °",fill:!1,backgroundColor:"blue",borderColor:"blue",data:t},{label:"Y °",fill:!1,backgroundColor:"orange",borderColor:"orange",data:o},{label:"Z °",fill:!1,backgroundColor:"green",borderColor:"green",data:r}]},s=$("#"+a);new Chart(s,{type:"line",data:n,options:{responsive:!0,maintainAspectRatio:!0,scales:{scales:{xAxes:[{scaleLabel:{display:!0,labelString:"Date"}}],yAxes:[{ticks:{beginAtZero:!1},scaleLabel:{display:!0,labelString:"Height (m)"}}]},legend:{display:!0},title:{display:!0,text:"Inclinometre en fonction du temps"},pan:{enabled:!1,mode:"xy"},zoom:{enabled:!1,mode:"xy"}}}})}function drawChartAngleXYZFromData(e,a,t=null){"object"!=typeof e&&(e=JSON.parse(e));if(!isEmpty(e)){var o=[],r=[],i=[],l=[];for(var n in e)o.push(e[n].angle_x),r.push(e[n].angle_y),i.push(e[n].angle_z),l.push(e[n].date_d);switch(t){case"x":var s=!0;break;case"y":var d=!0;case"z":var p=!0}const h=computeAverage(o),x=computeAverage(r),v=computeAverage(i);var c=Math.max(parseInt(h),parseInt(x))+10,b=Math.min(parseInt(h),parseInt(x))-10,u=parseInt(v+10),g=parseInt(v-10),m={labels:l,datasets:[{label:"X °",fill:!1,backgroundColor:"#20324B",borderColor:"#20324B",data:o,yAxisID:"y-axis-1",hidden:s},{label:"Y °",fill:!1,backgroundColor:"orange",borderColor:"orange",data:r,yAxisID:"y-axis-1",hidden:d},{label:"Z °",fill:!1,backgroundColor:"royalblue",borderColor:"royalblue",data:i,yAxisID:"y-axis-2",hidden:p}]},y=$("#"+a);return new Chart(y,{type:"line",data:m,options:{responsive:!0,hoverMode:"index",maintainAspectRatio:!0,stacked:!1,title:{display:!0,text:"Valeurs d'inclinaison en fonction du temps",fontSize:18},scales:{yAxes:[{type:"linear",display:!0,position:"left",id:"y-axis-1",scaleLabel:{display:!0,labelString:"X° and Y°"},ticks:{min:b,max:c,beginAtZero:!1,stepSize:.5,autoskip:!0,maxTicksLimit:10}},{type:"linear",display:!1,position:"right",id:"y-axis-2",scaleLabel:{display:!0,labelString:"Z°"},ticks:{min:g,max:u,beginAtZero:!1,stepSize:10,autoskip:!0,maxTicksLimit:10},gridLines:{drawOnChartArea:!1}}],xAxes:[{ticks:{autoskip:!0,maxTicksLimit:15}}]},legend:{display:!1},pan:{enabled:!0,drag:{animationDuration:1e3,borderColor:"rgba(225,225,225,0.3)",borderWidth:5,backgroundColor:"rgb(225,225,225)"},mode:"y"},zoom:{enabled:!0,mode:"y",speed:.1}}})}drawNoDataAvailable(a)}Chart.defaults.global.plugins.datalabels.display=!1,drawArrow=function(e,a,t,o,r){var i=o-a,l=r-t,n=Math.atan2(l,i);e.moveTo(a,t),e.lineTo(o,r),e.lineTo(o-10*Math.cos(n-Math.PI/6),r-10*Math.sin(n-Math.PI/6)),e.moveTo(o,r),e.lineTo(o-10*Math.cos(n+Math.PI/6),r-10*Math.sin(n+Math.PI/6))};var isFirstDateSuperiorToSecondDate=function(e,a){return e=moment(e,"DD/MM/YYYY HH:mm:ss").format("ll"),console.log("isFirstDateSuperiorToSecondDate -> date1",e),a=moment(a,"DD/MM/YYYY HH:mm:ss").format("ll"),console.log("isFirstDateSuperiorToSecondDate -> date2",a),moment(e).isSameOrAfter(a,"day")};function drawVariationChartAngleXYZFromData(e,a,t=!0,o=null){switch("object"!=typeof e&&(e=JSON.parse(e)),o){case"x":var r=!0;break;case"y":var i=!0;case"z":var l=!0}let n="",s="";t?(n="Pourcentage de variation de l'inclinaison au fil du temps depuis le jour d'installation",s="Variation %"):(n="Variation absolue de l'inclinaison au fil du temps depuis le jour d'installation",s="Variation absolue X et Y °");var d=[],p=[],c=[],b=[];for(var u in e)d.push(e[u].variationAngleX),p.push(e[u].variationAngleY),c.push(e[u].variationAngleZ),b.push(e[u].date);computeAverage(d),computeAverage(p);var g=2*Math.max.apply(Math,d),m=2*Math.min.apply(Math,d),y={labels:b,datasets:[{label:"X °",fill:!1,backgroundColor:"#20324B",borderColor:"#20324B",data:d,yAxisID:"y-axis-0",hidden:r},{label:"Y °",fill:!1,backgroundColor:"orange",borderColor:"orange",data:p,yAxisID:"y-axis-0",hidden:i},{label:"Z °",fill:!1,backgroundColor:"royalblue",borderColor:"royalblue",data:c,yAxisID:"y-axis-0",hidden:l}]},h=$("#"+a);new Chart(h,{type:"line",data:y,options:{responsive:!0,hoverMode:"index",maintainAspectRatio:!0,title:{display:!0,text:n,fontSize:18},scales:{yAxes:[{id:"y-axis-0",gridLines:{display:!0},ticks:{beginAtZero:!1,min:m,max:g},scaleLabel:{display:!0,labelString:s}}],xAxes:[{ticks:{autoskip:!0,maxTicksLimit:15}}]},legend:{display:!1},pan:{enabled:!0,mode:"y"},zoom:{enabled:!0,mode:"y"}}})}function drawChartSpectreFromData(e,a="canvas_spectre"){var t=[];dateTime=e.date_time;var o=e.min_freq,r=e.max_freq,i=2,l=4,n=[];Object.keys(e).length;count_resolution_1=0;for(var s=1;s<=5;s++)if(nameSub="subspectre_"+String(s),e.hasOwnProperty(nameSub)){t.push(e[nameSub]);var d=parseInt(e[nameSub].resolution),p=parseInt(e[nameSub].min_freq);r=parseInt(e[nameSub].max_freq);1==d&&(count_resolution_1=!0);for(var c=0;c<e[nameSub].data.length/2;c++){var b=accumulatedTable32(hex2dec(e[nameSub].data.substring(i,l)));if(c>0&&(p+=d),c<e[nameSub].data.length/2-1){var u={x:p,y:b};n.push(u)}i+=2,l+=2}i=2,l=4}var g=document.getElementById(a).getContext("2d"),m=g.createLinearGradient(0,0,0,400);m.addColorStop(0,"rgba(250,174,50,1)"),m.addColorStop(1,"rgba(250,174,50,0)");var y="Spectre du "+dateTime;new Chart(g,{type:"scatter",data:{datasets:[{showLine:!0,borderColor:"#3e95cd",backgroundColor:m,pointBackgroundColor:"#3e95cd",data:n}]},options:{responsive:!0,maintainAspectRatio:!0,scales:{display:!0,xAxes:[{gridLines:{display:!0},ticks:{beginAtZero:!1,min:o,max:r},scaleLabel:{display:!0,labelString:"Frequence (Hz)"}}],yAxes:[{gridLines:{display:!0},ticks:{beginAtZero:!1},scaleLabel:{display:!0,labelString:"AmplitudeArr (mg)"}}]},legend:{display:!1},title:{display:!0,text:y},pan:{enabled:!0,mode:"y"},zoom:{enabled:!0,mode:"y"}}})}function drawChartSpeedVariationFromData(e,a="chartVitesseInclinometer"){if("object"!=typeof chocData&&(e=JSON.parse(e)),isEmpty(e))drawNoDataAvailable(a);else{var t=[],o=[];for(var r in e)t.push(e[r].delta_xy_cm),o.push(e[r].date);var i=Math.max.apply(null,t)+1,l=(Math.min.apply(null,t),{labels:o,datasets:[{label:"Deplacement",backgroundColor:"rgba(255,99,132,0.2)",borderColor:"rgba(255,99,132,1)",borderWidth:2,hoverBackgroundColor:"rgba(255,99,132,0.4)",hoverBorderColor:"rgba(255,99,132,1)",data:t}]}),n=$("#"+a);new Chart(n,{type:"line",data:l,options:{responsive:!0,maintainAspectRatio:!0,title:{display:!1,text:"Vitesse de déplacement"},scales:{xAxes:[{scaleLabel:{display:!0,labelString:"Date"},ticks:{autoskip:!0,source:o,maxTicksLimit:20}}],yAxes:[{ticks:{min:-1,max:i,beginAtZero:!1,stepSize:.5,autoskip:!0,maxTicksLimit:20},scaleLabel:{display:!0,labelString:"Deplacement (cm)"}}]},legend:{display:!1},pan:{enabled:!0,mode:"xy"},zoom:{enabled:!0,mode:"xy"}}})}}function drawChartDirectionFromData(e,a="chartDirectionInclinometer",t=[]){if("object"!=typeof e&&(e=JSON.parse(e)),o=searchJsonInArray(t,"name_setting","first_inclinationX_thresh"),r=searchJsonInArray(t,"name_setting","first_inclinationY_thresh"),i=searchJsonInArray(t,"name_setting","second_inclinationY_thresh"),l=searchJsonInArray(t,"name_setting","third_inclinationY_thresh"),null!=o&&1==o.activated)var o=o.value;if(null!=r&&1==r.activated)var r=r.value;if(null!=i&&1==i.activated)var i=i.value;if(null!=l&&1==l.activated)var l=l.value;if(isEmpty(e))drawNoDataAvailable(a);else{var n=[],s=[],d=[],p=new Map;for(var c in e){let a=e[c].date;s.push(e[c].delta_x),d.push(e[c].delta_y);var b={x:e[c].delta_x,y:e[c].delta_y},u=e[c].delta_x*e[c].delta_y;n.push(b),p.set(u,a)}ratioAxisX=computeRatioAxis(s),ratioAxisY=computeRatioAxis(d);var g=document.getElementById(a).getContext("2d"),m=[],y=[],h=[],x=new Chart(g,{type:"scatter",data:{datasets:[{type:"scatter",label:"Direction des déplacements",pointBackgroundColor:y,borderColor:h,borderWidth:2,hoverBackgroundColor:"rgba(255,99,132,0.4)",hoverBorderColor:"rgba(255,99,132,1)",pointRadius:m,data:n}]},options:{maintainAspectRatio:!1,responsive:!1,tooltips:{callbacks:{title:function(e,a){return"Le "+p.get(e[0].value*e[0].label)},label:function(e,a){return"X = "+e.xLabel+" Y ="+e.yLabel},afterLabel:function(e,a){}},backgroundColor:"#FFF",titleFontSize:15,titleFontColor:"#233754",bodyFontColor:"#000",bodyFontSize:14,displayColors:!1},title:{display:!1,text:"Direction et inclinaison"},legend:{display:!1},scales:{yAxes:[{id:"y-axis-0",gridLines:{display:!0,color:"rgba(255,99,132,0.2)"},scaleLabel:{display:!0,labelString:"Delta Y (cm)",fontSize:20},ticks:{min:-10,max:10,beginAtZero:!1,stepSize:.5,autoskip:!0}}],xAxes:[{id:"x-axis-0",gridLines:{display:!0,color:"rgba(255,99,132,0.2)"},scaleLabel:{display:!0,labelString:"Delta X (cm)",fontSize:20},ticks:{min:-10,max:10,beginAtZero:!1,stepSize:.5,autoskip:!0}}]},pan:{enabled:!0,mode:"xy"},zoom:{enabled:!0,mode:"xy"},annotation:{events:["click"],drawTime:"afterDatasetsDraw",annotations:[{id:"hline1",type:"line",mode:"vertical",scaleID:"x-axis-0",value:0,borderColor:"rgba(103, 128, 159, 0.7)",label:{enabled:!0,content:"Y",position:"top",backgroundColor:"rgba(103, 128, 159, 0.7)"}},{id:"hline2",type:"line",mode:"horizontal",scaleID:"y-axis-0",value:0,borderColor:"rgba(103, 128, 159, 0.7)",label:{backgroundColor:"rgba(103, 128, 159, 0.7)",content:"X",position:"right",enabled:!0}},{id:"hline3",type:"line",mode:"horizontal",scaleID:"y-axis-0",value:r,borderColor:"rgba(240, 52, 52, 0.8)",label:{backgroundColor:"rgba(240, 52, 52, 0.8)",content:"First level Y",position:"top",enabled:!0}},{id:"hline4",type:"line",mode:"horizontal",scaleID:"y-axis-0",value:i,borderColor:"rgba(240, 52, 52, 0.8)",label:{backgroundColor:"rgba(240, 52, 52, 0.8)",content:"Second level Y",position:"top",enabled:!0}},{id:"hline5",type:"line",mode:"horizontal",scaleID:"y-axis-0",value:l,borderColor:"rgba(240, 52, 52, 0.8)",label:{backgroundColor:"rgba(240, 52, 52, 0.8)",content:"Third level Y",position:"top",enabled:!0}},{id:"hline6",type:"line",mode:"vertical",scaleID:"x-axis-0",value:o,borderColor:"rgba(240, 52, 52, 0.8)",label:{backgroundColor:"rgba(240, 52, 52, 0.8)",content:"First level X",position:"top",enabled:!0}}]}}});for(c=0;c<x.data.datasets[0].data.length-4;c++)y.push("rgba(103, 128, 159, 0.7)"),h.push("rgba(103, 128, 159, 1)"),m.push(.01*c);for(c=x.data.datasets[0].data.length-4;c<x.data.datasets[0].data.length;c++)c<x.data.datasets[0].data.length-1?(y.push("rgba(103, 128, 159, 0.7)"),h.push("rgba(103, 128, 159, 1)"),m.push(.05*c)):(y.push("rgba(255,99,132,1)"),m.push(7));for(c=0;c<x.data.datasets[0].data.length;c++);x.update()}}function drawChartDirectionFromDataWithRegression(e,a=null,t="chartDirectionInclinometer",o=[]){if("object"!=typeof e&&(e=JSON.parse(e)),r=searchJsonInArray(o,"name_setting","first_inclinationX_thresh"),i=searchJsonInArray(o,"name_setting","first_inclinationY_thresh"),l=searchJsonInArray(o,"name_setting","second_inclinationY_thresh"),n=searchJsonInArray(o,"name_setting","third_inclinationY_thresh"),null!=r&&1==r.activated)var r=r.value;if(null!=i&&1==i.activated)var i=i.value;if(null!=l&&1==l.activated)var l=l.value;if(null!=n&&1==n.activated)var n=n.value;if(isEmpty(e))drawNoDataAvailable(t);else{var s=[],d=[],p=[],c=[],b=new Map;for(var u in e){let a=e[u].date;p.push(e[u].delta_x),c.push(e[u].delta_y);var g={x:e[u].delta_x,y:e[u].delta_y},m=e[u].delta_x*e[u].delta_y;s.push(g),b.set(m,a)}if(a){"object"!=typeof a&&(a=JSON.parse(a));const t=s.map(({x:e,y:a})=>[e,a]);console.log("clean_data",t),console.log("regression",a),console.log("Type",typeof a);const o=regression.linear([t]);console.log("result",o);o.equation[0],o.equation[1];for(var u in e){g={x:e[u].delta_x,y:e[u].delta_x*a.slope+a.intercept};d.push(g)}val1RegX=-3,val2RegX=5,val1RegY=val1RegX*a.slope+a.intercept,console.log("val1Reg",0),val2RegY=val2RegX*a.slope+a.intercept,console.log("val2Reg",0),console.log("Youhou dataRegressionArr",d),console.log("dataRegressionArr value init",d[0].x)}ratioAxisX=computeRatioAxis(p),ratioAxisY=computeRatioAxis(c);var y=document.getElementById(t).getContext("2d"),h=[],x=[],v=[],f={datasets:[{type:"scatter",label:"Direction des déplacements",pointBackgroundColor:x,borderColor:v,borderWidth:2,hoverBackgroundColor:"rgba(255,99,132,0.4)",hoverBorderColor:"rgba(255,99,132,1)",pointRadius:h,data:s},{type:"line",label:"Trendline",borderWidth:2,data:[{x:val1RegX,y:val1RegY},{x:val2RegX,y:val2RegY}]}]},C=new Chart(y,{type:"scatter",data:f,options:{maintainAspectRatio:!1,responsive:!1,tooltips:{callbacks:{title:function(e,a){return"Le "+b.get(e[0].value*e[0].label)},label:function(e,a){return"X = "+e.xLabel+" Y ="+e.yLabel},afterLabel:function(e,a){}},backgroundColor:"#FFF",titleFontSize:15,titleFontColor:"#233754",bodyFontColor:"#000",bodyFontSize:14,displayColors:!1},title:{display:!1,text:"Direction et inclinaison"},legend:{display:!1},scales:{yAxes:[{id:"y-axis-0",gridLines:{display:!0,color:"rgba(255,99,132,0.2)"},scaleLabel:{display:!0,labelString:"Delta Y (cm)",fontSize:20},ticks:{min:-10,max:10,beginAtZero:!1,stepSize:.5,autoskip:!0}}],xAxes:[{id:"x-axis-0",gridLines:{display:!0,color:"rgba(255,99,132,0.2)"},scaleLabel:{display:!0,labelString:"Delta X (cm)",fontSize:20},ticks:{min:-10,max:10,beginAtZero:!1,stepSize:.5,autoskip:!0}}]},pan:{enabled:!0,mode:"xy"},zoom:{enabled:!0,mode:"xy"},annotation:{events:["click"],drawTime:"afterDatasetsDraw",annotations:[{id:"hline1",type:"line",mode:"vertical",scaleID:"x-axis-0",value:0,borderColor:"rgba(103, 128, 159, 0.7)",label:{enabled:!0,content:"Y",position:"top",backgroundColor:"rgba(103, 128, 159, 0.7)"}},{id:"hline2",type:"line",mode:"horizontal",scaleID:"y-axis-0",value:0,borderColor:"rgba(103, 128, 159, 0.7)",label:{backgroundColor:"rgba(103, 128, 159, 0.7)",content:"X",position:"right",enabled:!0}},{id:"hline3",type:"line",mode:"horizontal",scaleID:"y-axis-0",value:i,borderColor:"rgba(240, 52, 52, 0.8)",label:{backgroundColor:"rgba(240, 52, 52, 0.8)",content:"First level Y",position:"top",enabled:!0}},{id:"hline4",type:"line",mode:"horizontal",scaleID:"y-axis-0",value:l,borderColor:"rgba(240, 52, 52, 0.8)",label:{backgroundColor:"rgba(240, 52, 52, 0.8)",content:"Second level Y",position:"top",enabled:!0}},{id:"hline5",type:"line",mode:"horizontal",scaleID:"y-axis-0",value:n,borderColor:"rgba(240, 52, 52, 0.8)",label:{backgroundColor:"rgba(240, 52, 52, 0.8)",content:"Third level Y",position:"top",enabled:!0}},{id:"hline6",type:"line",mode:"vertical",scaleID:"x-axis-0",value:r,borderColor:"rgba(240, 52, 52, 0.8)",label:{backgroundColor:"rgba(240, 52, 52, 0.8)",content:"First level X",position:"top",enabled:!0}}]}}});for(u=0;u<C.data.datasets[0].data.length-4;u++)x.push("rgba(103, 128, 159, 0.7)"),v.push("rgba(103, 128, 159, 1)"),h.push(.01*u);for(u=C.data.datasets[0].data.length-4;u<C.data.datasets[0].data.length;u++)u<C.data.datasets[0].data.length-1?(x.push("rgba(103, 128, 159, 0.7)"),v.push("rgba(103, 128, 159, 1)"),h.push(.05*u)):(x.push("rgba(255,99,132,1)"),h.push(7));for(u=0;u<C.data.datasets[0].data.length;u++);C.update()}}function drawChartChocFromData(e,a="canvas_choc"){"object"!=typeof e&&(e=JSON.parse(e));var t=[],o=[];t.push(parseFloat(e[0].amplitudeArr_1)),t.push(parseFloat(e[0].amplitudeArr_2)),o.push(parseFloat(e[0].timeArr_1)),o.push(parseFloat(e[0].timeArr_2)),[].push(e[0].date_d);var r=[];r.push({x:0,y:0});for(var i=0;i<2;i++){var l={x:o[i],y:t[i]};r.push(l)}var n={x:o[0]+o[1],y:0};r.push(n);var s={datasets:[{data:r,showLine:!0}]},d="Last choc which occur on "+e[0].date_d,p=$("#"+a);new Chart(p,{type:"scatter",data:s,options:{scales:{display:!0,xAxes:[{ticks:{beginAtZero:!0,min:0,max:o[0]+o[1],step:.01},type:"linear",scaleLabel:{display:!0,labelString:"Time (s)"}}],yAxes:[{ticks:{beginAtZero:!0},scaleLabel:{display:!0,labelString:"AmplitudeArr (g)"}}]},legend:{display:!1},title:{display:!0,text:d}}})}function drawChartSubSpectreFromData(e,a="canvas_subspectre"){"object"!=typeof e&&(e=JSON.parse(e)),subspectre_hex=e[0].payload,min_freq=parseInt(e[0].min_freq),max_freq=parseInt(e[0].max_freq),resolution=parseInt(e[0].resolution),subspectre_number=e[0].subspectre_number;for(var t=2,o=4,r=[],i=min_freq,l=0;l<subspectre_hex.length/2;l++){var n=hex2dec(subspectre_hex.substring(t,o));if(l>0&&(min_freq+=resolution),l<subspectre_hex.length/2-1){var s={x:min_freq,y:n};r.push(s)}t+=2,o+=2}var d="Spectre | Resolution = "+String(resolution)+"Hz | Sous spectre = "+String(subspectre_number),p={datasets:[{data:r,showLine:!0}]},c=$("#"+a);new Chart(c,{type:"scatter",data:p,options:{scales:{display:!0,xAxes:[{ticks:{beginAtZero:!1,min:i,max:max_freq},scaleLabel:{display:!0,labelString:"Frequence (Hz)"}}],yAxes:[{ticks:{beginAtZero:!1},scaleLabel:{display:!0,labelString:"AmplitudeArr (mg)"}}]},legend:{display:!1},title:{display:!0,text:d}}})}function showMap(e){console.log("Data :",e),e=JSON.parse(e);var a=L.map("map",{attributionControl:!1}).setView([46.2276,2.2137],5.3);L.tileLayer("https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibGlyb25lIiwiYSI6ImNrMmdrdmo1czAwOXozb29oc3NybXJqNTcifQ.sbQPrGi1n7lsCtlCvojTBA",{maxZoom:18,attribution:'<a href="https://flod.ai">Flod Sentiel</a>',id:"mapbox.streets"}).addTo(a),L.control.custom({position:"topright",content:'<button type="button" class="btn btn-default">    <i class="fa fa-crosshairs"></i></button><button type="button" class="btn btn-danger">    <i class="fa fa-times"></i></button><button type="button" class="btn btn-success">    <i class="fa fa-check"></i></button><button type="button" class="btn btn-warning">    <i class="fa fa-exclamation-triangle"></i></button>',classes:"btn-group-vertical btn-group-sm",style:{margin:"30px",padding:"0px 0 0 0",cursor:"pointer",height:"100px"},datas:{foo:"bar"},events:{click:function(e){console.log("wrapper div element clicked"),console.log(e)},dblclick:function(e){console.log("wrapper div element dblclicked"),console.log(e)},contextmenu:function(e){console.log("wrapper div element contextmenu"),console.log(e)}}}).addTo(a);for(var t=0;t<e.length;t++){var o=e[t];null==o.longitude_sensor&&null==o.latitude_sensor||(longitude_sensor=o.longitude_sensor,latitude_sensor=o.latitude_sensor,device_number=o.device_number,site=o.site,equipement=o.equipement,line_HT=o.transmission_line_name,L.marker([latitude_sensor,longitude_sensor]).addTo(a).bindPopup("<b>Capteur : "+device_number+"</b><br />"+site+" | "+equipement+" | "+line_HT).openPopup())}}function addData(e,a,t,o){e.data.datasets.push({label:a,backgroundColor:t,data:o}),e.update()}function drawPrevision(e){var a,t;window.weatherWidgetConfig=window.weatherWidgetConfig||[],window.weatherWidgetConfig.push({selector:".weatherForecastWidget",apiKey:"052NMBEM22M3WRCGVFD7209PV",location:e,unitGroup:"metric"}),a=document,(t=a.createElement("script")).src="public/js/weather-forecast-widget.min.js",t.setAttribute("data-timestamp",+new Date),(a.head||a.body).appendChild(t)}