function drawChartNbChocDate(e,a="canvas_choc_nb"){"object"!=typeof e&&(e=JSON.parse(e));var t=[],s=[];for(var r in e)t.push(e[r].nb_choc),s.push(e[r].date_d);var o={labels:s,datasets:[{labels:s,data:t}]},n=$("#"+a);new Chart(n,{type:"bar",data:o,options:{maintainAspectRatio:!0,responsive:!0,scales:{xAxes:[{scaleLabel:{display:!0,labelString:"Date"},gridLines:{display:!1}}],yAxes:[{ticks:{beginAtZero:!0,stepSize:1},gridLines:{display:!1},scaleLabel:{display:!0,labelString:"Nombre Choc"}}]},legend:{display:!1},title:{display:!0,text:"Nombre de choc par jour"}}})}function drawPowerChocPerDate(e,a="canvas_choc_nb"){"object"!=typeof e&&(e=JSON.parse(e));var t=[],s=[],r=Array(),o=[];for(var n in e){var l=new Date(e[n].date_d),i={x:l=getFormattedDate(l),y:e[n].power};o.push(i),count=n,s.includes(e[n].date_d)||(1,0,r.length>0&&t.push(r),r=Array(),s.push(e[n].date_d)),s.includes(e[n].date_d)&&(r.push(e[n].power),1)}t.push(r);var d=$("#"+a);console.log(o);new Chart(d,{type:"scatter",data:{datasets:[{label:"Puissance du choc",data:o,fill:!1,showLine:!1,backgroundColor:"#F5DEB3",borderColor:"red"}]},options:{maintainAspectRatio:!0,responsive:!0,title:{display:!0,text:"Chart.js Time Scale"},scales:{xAxes:[{type:"time",ticks:{source:"date"},time:{format:"DD/MM/YYYY",unit:"day",tooltipFormat:"DD/MM/YYYY",scaleLabel:{display:!0,labelString:"Date"}}}],yAxes:[{scaleLabel:{display:!0,labelString:"Puissance"}}]}}})}function drawPowerChocPerDateBar(e,a="canvas_choc_nb"){"object"!=typeof e&&(e=JSON.parse(e));var t=[],s=[],r=$("#"+a),o=new Chart(r,{type:"bar",data:{labels:[],datasets:[{data:[]}]},options:{maintainAspectRatio:!0,responsive:!0,scales:{xAxes:[{stacked:!0,scaleLabel:{display:!0,labelString:"Date"},gridLines:{display:!1}}],yAxes:[{stacked:!0,ticks:{beginAtZero:!0,stepSize:.1},gridLines:{display:!1},scaleLabel:{display:!0,labelString:"Puissance du choc"}}]},legend:{display:!1},title:{display:!0,text:"Puissance des chocs par jour"}}}),n=Array();for(var l in e)l,s.includes(e[l].date_d)||(0,n.length>0&&t.push(n),n=Array(),s.push(e[l].date_d)),s.includes(e[l].date_d)&&(n.push(e[l].power),1);t.push(n);var i=[];for(var l in s)i.push({date:s[l],powerValues:t[l]});var d=Array("#919191","#4b809c","#106d9c","#a37524","#a34f3e");for(let e=0;e<6;e++){o.data.datasets.push({data:[]})}for(const[e,a]of Object.entries(i)){o.data.labels[e]=a.date,o.update();var p=a.powerValues.map((function(e){return parseFloat(e)})),c=Math.max.apply(null,p);Math.min.apply(null,p);for(let a=0;a<6;a++)a>=0&&a<p.length?(p[a]==c?o.data.datasets[a].backgroundColor="#d93c1c":o.data.datasets[a].backgroundColor=d[a],o.data.datasets[a].data[e]=p[a]):o.data.datasets[a].data[e]=0;o.update()}}function drawTemperatureFromData(e,a="canvas_temperature"){"object"!=typeof e&&(e=JSON.parse(e));var t=[],s=[];for(var r in e)t.push(e[r].temperature),s.push(e[r].date_d);var o={labels:s,datasets:[{labels:s,borderColor:"#3e95cd",backgroundColor:"#f6f6f6",pointBackgroundColor:"#3e95cd",hoverBackgroundColor:"rgba(200, 200, 200, 1)",hoverBorderColor:"rgba(200, 200, 200, 1)",data:t}]},n=$("#"+a);new Chart(n,{type:"line",data:o,options:{responsive:!0,maintainAspectRatio:!0,scales:{xAxes:[{scaleLabel:{display:!0,labelString:"Date"}}],yAxes:[{ticks:{beginAtZero:!1},scaleLabel:{display:!0,labelString:"Temeprature (Â°C)"}}]},legend:{display:!1},title:{display:!0,text:"Temperature en fonction du temps"}}})}function drawInclinometerFromData(e,a="canvas_inclinometre"){"object"!=typeof e&&(e=JSON.parse(e));var t=[],s=[],r=[],o=[];for(var n in e)t.push(e[n].nx),s.push(e[n].ny),r.push(e[n].nz),o.push(e[n].date_d);var l={labels:o,datasets:[{label:"X",fill:!1,backgroundColor:"blue",borderColor:"blue",data:t},{label:"Y",fill:!1,backgroundColor:"orange",borderColor:"orange",data:s},{label:"Z",fill:!1,backgroundColor:"green",borderColor:"green",data:r}]},i=$("#"+a);new Chart(i,{type:"line",data:l,options:{responsive:!0,maintainAspectRatio:!0,scales:{scales:{xAxes:[{scaleLabel:{display:!0,labelString:"Date"}}],yAxes:[{ticks:{beginAtZero:!1},scaleLabel:{display:!0,labelString:"Height (m)"}}]},legend:{display:!0},title:{display:!0,text:"Inclinometre en fonction du temps"}}}})}function drawSpectreFromData(e,a="canvas_spectre"){var t=[],s=[],r=[],o=[],n=[];for(var l in e)t.push(e[l].subspectre),s.push(parseInt(e[l].min_freq)),r.push(parseInt(e[l].max_freq)),o.push(parseInt(e[l].resolution)),n.push(e[l].date);min_freq=parseInt(s[0]);var i=min_freq,d=Math.max.apply(Math,r),p=2,c=4,u=[];for(l=0;l<t.length;l++){for(var b=0;b<t[l].length/2;b++){var g=hex2dec(t[l].substring(p,c));if(b>0&&(min_freq+=o[l]),b<t[l].length/2-1){var h={x:min_freq,y:g};u.push(h)}p+=2,c+=2}p=2,c=4}var m=document.getElementById(a).getContext("2d"),y=m.createLinearGradient(0,0,0,400);y.addColorStop(0,"rgba(250,174,50,1)"),y.addColorStop(1,"rgba(250,174,50,0)");var f="Spectre pour la semaine du "+n[0]+" au "+n[n.length-1];new Chart(m,{type:"scatter",data:{datasets:[{showLine:!0,borderColor:"#3e95cd",backgroundColor:y,pointBackgroundColor:"#3e95cd",data:u}]},options:{responsive:!0,maintainAspectRatio:!0,scales:{display:!0,xAxes:[{gridLines:{display:!0},ticks:{beginAtZero:!1,min:i,max:d},scaleLabel:{display:!0,labelString:"Frequence (Hz)"}}],yAxes:[{gridLines:{display:!0},ticks:{beginAtZero:!1},scaleLabel:{display:!0,labelString:"AmplitudeArr (mg)"}}]},legend:{display:!1},title:{display:!0,text:f}}})}function drawChocFromData(e,a="canvas_choc"){"object"!=typeof e&&(e=JSON.parse(e));var t=[],s=[];t.push(parseFloat(e[0].amplitudeArr_1)),t.push(parseFloat(e[0].amplitudeArr_2)),s.push(parseFloat(e[0].timeArr_1)),s.push(parseFloat(e[0].timeArr_2)),[].push(e[0].date_d);var r=[],o={x:0,y:0};r.push(o);for(var n=0;n<2;n++){o={x:s[n],y:t[n]};r.push(o)}o={x:s[0]+s[1],y:0};r.push(o);var l={datasets:[{data:r,showLine:!0}]},i="Last choc which occur on "+e[0].date_d,d=$("#"+a);new Chart(d,{type:"scatter",data:l,options:{scales:{display:!0,xAxes:[{ticks:{beginAtZero:!0,min:0,max:s[0]+s[1],step:.01},type:"linear",scaleLabel:{display:!0,labelString:"Time (s)"}}],yAxes:[{ticks:{beginAtZero:!0},scaleLabel:{display:!0,labelString:"AmplitudeArr (g)"}}]},legend:{display:!1},title:{display:!0,text:i}}})}function drawSubSpectreFromData(e,a="canvas_subspectre"){"object"!=typeof e&&(e=JSON.parse(e)),subspectre_hex=e[0].payload,min_freq=parseInt(e[0].min_freq),max_freq=parseInt(e[0].max_freq),resolution=parseInt(e[0].resolution),subspectre_number=e[0].subspectre_number;for(var t=2,s=4,r=[],o=min_freq,n=0;n<subspectre_hex.length/2;n++){var l=hex2dec(subspectre_hex.substring(t,s));if(n>0&&(min_freq+=resolution),n<subspectre_hex.length/2-1){var i={x:min_freq,y:l};r.push(i)}t+=2,s+=2}var d="Spectre | Resolution = "+String(resolution)+"Hz | Sous spectre = "+String(subspectre_number),p={datasets:[{data:r,showLine:!0}]},c=$("#"+a);new Chart(c,{type:"scatter",data:p,options:{scales:{display:!0,xAxes:[{ticks:{beginAtZero:!1,min:o,max:max_freq},scaleLabel:{display:!0,labelString:"Frequence (Hz)"}}],yAxes:[{ticks:{beginAtZero:!1},scaleLabel:{display:!0,labelString:"AmplitudeArr (mg)"}}]},legend:{display:!1},title:{display:!0,text:d}}})}function showMap(e){e=JSON.parse(e);var a=L.map("map",{attributionControl:!1}).setView([46.2276,2.2137],5.3);L.tileLayer("https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibGlyb25lIiwiYSI6ImNrMmdrdmo1czAwOXozb29oc3NybXJqNTcifQ.sbQPrGi1n7lsCtlCvojTBA",{maxZoom:18,attribution:'<a href="https://flod.ai">Flod Sentiel</a>',id:"mapbox.streets"}).addTo(a),L.control.custom({position:"topright",content:'<button type="button" class="btn btn-default">    <i class="fa fa-crosshairs"></i></button><button type="button" class="btn btn-danger">    <i class="fa fa-times"></i></button><button type="button" class="btn btn-success">    <i class="fa fa-check"></i></button><button type="button" class="btn btn-warning">    <i class="fa fa-exclamation-triangle"></i></button>',classes:"btn-group-vertical btn-group-sm",style:{margin:"30px",padding:"0px 0 0 0",cursor:"pointer",height:"100px"},datas:{foo:"bar"},events:{click:function(e){console.log("wrapper div element clicked"),console.log(e)},dblclick:function(e){console.log("wrapper div element dblclicked"),console.log(e)},contextmenu:function(e){console.log("wrapper div element contextmenu"),console.log(e)}}}).addTo(a);for(var t=0;t<e.length;t++){var s=e[t];null==s.longitude_sensor&&null==s.latitude_sensor||(longitude_sensor=s.longitude_sensor,latitude_sensor=s.latitude_sensor,sensor_id=s.sensor_id,site=s.site,equipement=s.equipement,L.marker([latitude_sensor,longitude_sensor]).addTo(a).bindPopup("<b>"+site+"</b><br />"+equipement).openPopup())}}function addData(e,a,t,s){e.data.datasets.push({label:a,backgroundColor:t,data:s}),e.update()}