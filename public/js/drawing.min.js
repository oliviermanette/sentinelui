function drawChartNbChocPerDate(e,a="canvas_choc_nb"){if("object"!=typeof e&&(e=JSON.parse(e)),isEmpty(e))drawNoDataAvailable(a);else{var t=[],r=[];for(var o in e)t.push(e[o].nb_choc),r.push(e[o].date_d);var s={labels:r,datasets:[{labels:r,data:t}]},n=$("#"+a),l={maintainAspectRatio:!1,responsive:!0,plugins:[ChartDataLabels],scales:{xAxes:[{scaleLabel:{display:!0,labelString:"Date"},gridLines:{display:!1}}],yAxes:[{ticks:{beginAtZero:!0,stepSize:1},gridLines:{display:!1},scaleLabel:{display:!0,labelString:"Nombre Choc"}}]},legend:{display:!1},title:{display:!0,text:"Nombre de choc enregistré",fontSize:15},pan:{enabled:!1,mode:"xy"},zoom:{enabled:!1,mode:"xy"}};new Chart(n,{type:"bar",data:s,options:l})}}function drawChartPowerChocPerDate(e,a="canvas_choc_nb"){if("object"!=typeof e&&(e=JSON.parse(e)),isEmpty(e))drawNoDataAvailable(a);else{var t=[],r=[],o=Array(),s=[];for(var n in e){var l=new Date(e[n].date_d),i={x:l=getFormattedDate(l),y:e[n].power};s.push(i),count=n,r.includes(e[n].date_d)||(1,0,o.length>0&&t.push(o),o=Array(),r.push(e[n].date_d)),r.includes(e[n].date_d)&&(o.push(e[n].power),1)}t.push(o);var d=$("#"+a);new Chart(d,{type:"scatter",data:{datasets:[{label:"Puissance du choc (g)",data:s,fill:!1,showLine:!1,backgroundColor:"#F5DEB3",borderColor:"red"}]},options:{maintainAspectRatio:!0,responsive:!0,title:{display:!0,text:"Chart.js Time Scale"},scales:{xAxes:[{stacked:!0,type:"time",ticks:{source:"date"},time:{format:"DD/MM/YYYY",unit:"day",tooltipFormat:"DD/MM/YYYY",scaleLabel:{display:!0,labelString:"Date"}}}],yAxes:[{stacked:!1,scaleLabel:{display:!0,labelString:"Puissance"}}]},pan:{enabled:!1,mode:"xy"},zoom:{enabled:!1,mode:"xy"}}})}}function drawChartPowerChocPerDateBar(e,a="canvas_choc_nb"){if("object"!=typeof e&&(e=JSON.parse(e)),isEmpty(e))drawNoDataAvailable(a);else{var t=[],r=[],o=$("#"+a),s=new Chart(o,{type:"bar",data:{labels:[],datasets:[{data:[]}]},options:{maintainAspectRatio:!1,responsive:!0,tooltips:{callbacks:{title:function(e,a){return"Le "+a.labels[e[0].index]+" à "+l.get(e[0].value).split(" ")[1]},label:function(e,a){return"Puissance : "+e.value+" g"},afterLabel:function(e,a){}},backgroundColor:"#FFF",titleFontSize:15,titleFontColor:"#233754",bodyFontColor:"#000",bodyFontSize:14,displayColors:!1},scales:{xAxes:[{stacked:!0,scaleLabel:{display:!0,labelString:"Date"},gridLines:{display:!1}}],yAxes:[{stacked:!0,ticks:{beginAtZero:!0,stepSize:.1},gridLines:{display:!1},scaleLabel:{display:!0,labelString:"Puissance du choc (g)"}}]},legend:{display:!1},title:{display:!0,text:"Puissance des chocs enregistrés",fontSize:15},pan:{enabled:!1,mode:"xy"},zoom:{enabled:!1,mode:"xy"}}}),n=Array(),l=new Map;for(var i in e){let a=e[i].date_d,o=a.split(" ")[0],s=(a.split(" ")[1],e[i].power);l.set(s,a),r.includes(o)||(0,n.length>0&&t.push(n),n=Array(),r.push(o)),r.includes(o)&&(n.push(s),1)}t.push(n);var d=[];for(var p in r)d.push({date:r[p],powerValues:t[p]});var c=Array("#919191","#4b809c","#106d9c","#a37524","#a34f3e");for(let e=0;e<12;e++){s.data.datasets.push({data:[]})}for(const[e,a]of Object.entries(d)){s.data.labels[e]=a.date,s.update();var b=a.powerValues.map((function(e){return parseFloat(e)})),u=Math.max.apply(null,b);Math.min.apply(null,b);for(let a=0;a<12;a++)a>=0&&a<b.length?(b[a]==u?s.data.datasets[a].backgroundColor="#d93c1c":s.data.datasets[a].backgroundColor=c[a],s.data.datasets[a].data[e]=b[a]):s.data.datasets[a].data[e]=0;s.update()}}}function drawChartTemperatureFromData(e,a="canvas_temperature"){"object"!=typeof e&&(e=JSON.parse(e));var t=[],r=[];for(var o in e)e[o].temperature<100&&(t.push(e[o].temperature),r.push(e[o].date_d));var s={labels:r,datasets:[{labels:r,borderColor:"#3e95cd",backgroundColor:"#f6f6f6",pointBackgroundColor:"#3e95cd",hoverBackgroundColor:"rgba(200, 200, 200, 1)",hoverBorderColor:"rgba(200, 200, 200, 1)",data:t}]},n=$("#"+a);new Chart(n,{type:"line",data:s,options:{responsive:!0,maintainAspectRatio:!1,scales:{xAxes:[{scaleLabel:{display:!0,labelString:"Date"},ticks:{autoskip:!0,maxTicksLimit:20}}],yAxes:[{ticks:{beginAtZero:!1},scaleLabel:{display:!0,labelString:"Temeprature (°C)"}}]},legend:{display:!1},title:{display:!0,text:"Temperature en fonction du temps"},pan:{enabled:!1,mode:"xy"},zoom:{enabled:!1,mode:"xy"}}})}function drawChartInclinometerFromData(e,a="canvas_inclinometre"){"object"!=typeof e&&(e=JSON.parse(e));var t=[],r=[],o=[],s=[];for(var n in e)t.push(e[n].nx),r.push(e[n].ny),o.push(e[n].nz),s.push(e[n].date_d);var l={labels:s,datasets:[{label:"X °",fill:!1,backgroundColor:"blue",borderColor:"blue",data:t},{label:"Y °",fill:!1,backgroundColor:"orange",borderColor:"orange",data:r},{label:"Z °",fill:!1,backgroundColor:"green",borderColor:"green",data:o}]},i=$("#"+a);new Chart(i,{type:"line",data:l,options:{responsive:!0,maintainAspectRatio:!0,scales:{scales:{xAxes:[{scaleLabel:{display:!0,labelString:"Date"}}],yAxes:[{ticks:{beginAtZero:!1},scaleLabel:{display:!0,labelString:"Height (m)"}}]},legend:{display:!0},title:{display:!0,text:"Inclinometre en fonction du temps"},pan:{enabled:!1,mode:"xy"},zoom:{enabled:!1,mode:"xy"}}}})}function drawChartAngleXYZFromData(e,a="canvas_inclinometre"){if("object"!=typeof e&&(e=JSON.parse(e)),!isEmpty(e)){var t=[],r=[],o=[],s=[];for(var n in e)t.push(e[n].angle_x),r.push(e[n].angle_y),o.push(e[n].angle_z),s.push(e[n].date_d);const u=computeAverage(t);console.log("TCL: drawChartAngleXYZFromData -> avgX",u);const g=computeAverage(r);console.log("TCL: drawChartAngleXYZFromData -> avgY",g);const m=computeAverage(o);var l=Math.max(parseInt(u),parseInt(g))+50;console.log("TCL: drawChartAngleXYZFromData -> rangeHighAxisX",l);var i=Math.min(parseInt(u),parseInt(g))-50;console.log("TCL: drawChartAngleXYZFromData -> rangeLowAxisX",i);var d=parseInt(m+50),p=parseInt(m-50),c={labels:s,datasets:[{label:"X °",fill:!1,backgroundColor:"#20324B",borderColor:"#20324B",data:t,yAxisID:"y-axis-1"},{label:"Y °",fill:!1,backgroundColor:"orange",borderColor:"orange",data:r,yAxisID:"y-axis-1"},{label:"Z °",fill:!1,backgroundColor:"royalblue",borderColor:"royalblue",data:o,yAxisID:"y-axis-2"}]},b=$("#"+a);return new Chart(b,{type:"line",data:c,options:{responsive:!0,hoverMode:"index",maintainAspectRatio:!0,stacked:!1,title:{display:!0,text:"Valeurs d'inclinaison en fonction du temps",fontSize:18},scales:{yAxes:[{type:"linear",display:!0,position:"left",id:"y-axis-1",scaleLabel:{display:!0,labelString:"X° and Y°"},ticks:{min:i,max:l,beginAtZero:!1,stepSize:.5,autoskip:!0,maxTicksLimit:10}},{type:"linear",display:!0,position:"right",id:"y-axis-2",scaleLabel:{display:!0,labelString:"Z°"},ticks:{min:p,max:d,beginAtZero:!1,stepSize:10,autoskip:!0,maxTicksLimit:10},gridLines:{drawOnChartArea:!1}}],xAxes:[{ticks:{autoskip:!0,maxTicksLimit:15}}]},pan:{enabled:!0,drag:{animationDuration:1e3,borderColor:"rgba(225,225,225,0.3)",borderWidth:5,backgroundColor:"rgb(225,225,225)"},mode:"y"},zoom:{enabled:!0,mode:"y",speed:.1}}})}drawNoDataAvailable(a)}function resetZoom(e){e.resetZoom()}function drawNoDataAvailable(e){Chart.plugins.register({afterDraw:function(e){if(0===e.data.datasets.length){var a=e.chart.ctx,t=e.chart.width,r=e.chart.height;e.clear(),a.save(),a.textAlign="center",a.textBaseline="middle",a.font="22px normal 'Helvetica Nueue'",a.fillStyle="gray",a.fillText("Pas de données disponible",t/2,r/2),a.restore()}}});var a=$("#"+e);new Chart(a,{type:"line",data:{labels:[],datasets:[]}})}function drawVariationChartAngleXYZFromData(e,a=!0,t="canvas_inclinometre",r=2){"object"!=typeof e&&(e=JSON.parse(e));let o="",s="";a?(o="Pourcentage de variation de l'inclinaison au fil du temps",s="Variation %"):(o="Variation absolue de l'inclinaison au fil du temps",s="Variation absolue °");var n=[],l=[],i=[],d=[];for(var p in e)n.push(e[p].variationAngleX),l.push(e[p].variationAngleY),i.push(e[p].variationAngleZ),d.push(e[p].date);var c={labels:d,datasets:[{label:"X °",fill:!1,backgroundColor:"#20324B",borderColor:"#20324B",data:n,yAxisID:"y-axis-0"},{label:"Y °",fill:!1,backgroundColor:"orange",borderColor:"orange",data:l,yAxisID:"y-axis-0"},{label:"Z °",fill:!1,backgroundColor:"royalblue",borderColor:"royalblue",data:i,yAxisID:"y-axis-0"}]},b=$("#"+t);new Chart(b,{type:"line",data:c,options:{responsive:!0,hoverMode:"index",maintainAspectRatio:!0,title:{display:!0,text:o,fontSize:18},scales:{yAxes:[{id:"y-axis-0",gridLines:{display:!0},ticks:{beginAtZero:!1,min:-r-1,max:r+1},scaleLabel:{display:!0,labelString:s}}],xAxes:[{ticks:{autoskip:!0,maxTicksLimit:15}}]},pan:{enabled:!0,mode:"y"},zoom:{enabled:!0,mode:"y"},annotation:{events:["click"],drawTime:"afterDatasetsDraw",annotations:[{id:"hline1",type:"line",mode:"horizontal",scaleID:"y-axis-0",value:r,borderColor:"red",borderDash:[2,2],label:{enabled:!0,content:"Seuil d'alerte haut",backgroundColor:"red"},onClick:function(e){window.open("/settings")}},{id:"hline2",type:"line",mode:"horizontal",scaleID:"y-axis-0",value:-r,borderColor:"red",borderDash:[2,2],label:{backgroundColor:"red",content:"Seuil d'alerte bas",enabled:!0},onClick:function(e){window.open("/settings")}}]}}})}function drawChartSpectreFromData(e,a="canvas_spectre"){var t=[],r=[],o=[],s=[],n=[];for(var l in e)t.push(e[l].subspectre),r.push(parseInt(e[l].min_freq)),o.push(parseInt(e[l].max_freq)),s.push(parseInt(e[l].resolution)),n.push(e[l].date);min_freq=parseInt(r[0]);for(var i=min_freq,d=Math.max.apply(Math,o),p=2,c=4,b=[],u=0;u<t.length;u++){for(var g=0;g<t[u].length/2;g++){var m=hex2dec(t[u].substring(p,c));if(g>0&&(min_freq+=s[u]),g<t[u].length/2-1){var y={x:min_freq,y:m};b.push(y)}p+=2,c+=2}p=2,c=4}var h=document.getElementById(a).getContext("2d"),x=h.createLinearGradient(0,0,0,400);x.addColorStop(0,"rgba(250,174,50,1)"),x.addColorStop(1,"rgba(250,174,50,0)");var f="Spectre du "+n[0];new Chart(h,{type:"scatter",data:{datasets:[{showLine:!0,borderColor:"#3e95cd",backgroundColor:x,pointBackgroundColor:"#3e95cd",data:b}]},options:{responsive:!0,maintainAspectRatio:!0,scales:{display:!0,xAxes:[{gridLines:{display:!0},ticks:{beginAtZero:!1,min:i,max:d},scaleLabel:{display:!0,labelString:"Frequence (Hz)"}}],yAxes:[{gridLines:{display:!0},ticks:{beginAtZero:!1},scaleLabel:{display:!0,labelString:"AmplitudeArr (mg)"}}]},legend:{display:!1},title:{display:!0,text:f},pan:{enabled:!0,mode:"y"},zoom:{enabled:!0,mode:"y"}}})}function drawChartChocFromData(e,a="canvas_choc"){"object"!=typeof e&&(e=JSON.parse(e));var t=[],r=[];t.push(parseFloat(e[0].amplitudeArr_1)),t.push(parseFloat(e[0].amplitudeArr_2)),r.push(parseFloat(e[0].timeArr_1)),r.push(parseFloat(e[0].timeArr_2)),[].push(e[0].date_d);var o=[];o.push({x:0,y:0});for(var s=0;s<2;s++){var n={x:r[s],y:t[s]};o.push(n)}var l={x:r[0]+r[1],y:0};o.push(l);var i={datasets:[{data:o,showLine:!0}]},d="Last choc which occur on "+e[0].date_d,p=$("#"+a);new Chart(p,{type:"scatter",data:i,options:{scales:{display:!0,xAxes:[{ticks:{beginAtZero:!0,min:0,max:r[0]+r[1],step:.01},type:"linear",scaleLabel:{display:!0,labelString:"Time (s)"}}],yAxes:[{ticks:{beginAtZero:!0},scaleLabel:{display:!0,labelString:"AmplitudeArr (g)"}}]},legend:{display:!1},title:{display:!0,text:d}}})}function drawChartSubSpectreFromData(e,a="canvas_subspectre"){"object"!=typeof e&&(e=JSON.parse(e)),subspectre_hex=e[0].payload,min_freq=parseInt(e[0].min_freq),max_freq=parseInt(e[0].max_freq),resolution=parseInt(e[0].resolution),subspectre_number=e[0].subspectre_number;for(var t=2,r=4,o=[],s=min_freq,n=0;n<subspectre_hex.length/2;n++){var l=hex2dec(subspectre_hex.substring(t,r));if(n>0&&(min_freq+=resolution),n<subspectre_hex.length/2-1){var i={x:min_freq,y:l};o.push(i)}t+=2,r+=2}var d="Spectre | Resolution = "+String(resolution)+"Hz | Sous spectre = "+String(subspectre_number),p={datasets:[{data:o,showLine:!0}]},c=$("#"+a);new Chart(c,{type:"scatter",data:p,options:{scales:{display:!0,xAxes:[{ticks:{beginAtZero:!1,min:s,max:max_freq},scaleLabel:{display:!0,labelString:"Frequence (Hz)"}}],yAxes:[{ticks:{beginAtZero:!1},scaleLabel:{display:!0,labelString:"AmplitudeArr (mg)"}}]},legend:{display:!1},title:{display:!0,text:d}}})}function showMap(e){e=JSON.parse(e);var a=L.map("map",{attributionControl:!1}).setView([46.2276,2.2137],5.3);L.tileLayer("https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibGlyb25lIiwiYSI6ImNrMmdrdmo1czAwOXozb29oc3NybXJqNTcifQ.sbQPrGi1n7lsCtlCvojTBA",{maxZoom:18,attribution:'<a href="https://flod.ai">Flod Sentiel</a>',id:"mapbox.streets"}).addTo(a),L.control.custom({position:"topright",content:'<button type="button" class="btn btn-default">    <i class="fa fa-crosshairs"></i></button><button type="button" class="btn btn-danger">    <i class="fa fa-times"></i></button><button type="button" class="btn btn-success">    <i class="fa fa-check"></i></button><button type="button" class="btn btn-warning">    <i class="fa fa-exclamation-triangle"></i></button>',classes:"btn-group-vertical btn-group-sm",style:{margin:"30px",padding:"0px 0 0 0",cursor:"pointer",height:"100px"},datas:{foo:"bar"},events:{click:function(e){console.log("wrapper div element clicked"),console.log(e)},dblclick:function(e){console.log("wrapper div element dblclicked"),console.log(e)},contextmenu:function(e){console.log("wrapper div element contextmenu"),console.log(e)}}}).addTo(a);for(var t=0;t<e.length;t++){var r=e[t];null==r.longitude_sensor&&null==r.latitude_sensor||(longitude_sensor=r.longitude_sensor,latitude_sensor=r.latitude_sensor,sensor_id=r.sensor_id,site=r.site,equipement=r.equipement,L.marker([latitude_sensor,longitude_sensor]).addTo(a).bindPopup("<b>"+site+"</b><br />"+equipement).openPopup())}}function addData(e,a,t,r){e.data.datasets.push({label:a,backgroundColor:t,data:r}),e.update()}Chart.defaults.global.plugins.datalabels.display=!1;